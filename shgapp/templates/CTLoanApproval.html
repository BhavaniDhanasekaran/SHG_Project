{% extends 'base.html' %}
{% load staticfiles %}
{% block javascript %}
<script src="{% static 'datajs/grouplist.js' %}"></script>
<script src="{% static 'datajs/loadTaskList.js' %}"></script>
<script src="{% static 'datajs/masterData.js' %}"></script>
<script src="{% static 'datajs/mysidenav.js' %}"></script>
<script>
    var groupId = '{{ groupId | escapejs }}';
    var group= '{{ group | escapejs }}';
    var loanId = '{{ loanId | escapejs }}';
    var userId = '{{ userId | escapejs }}';
    var taskName = '{{ taskName | escapejs }}';
    var taskId = '{{ taskId | escapejs }}';

    var processInstanceId = '{{ processInstanceId | escapejs }}';

    $(document).ready(function(){
        taskCount();
        loadGroupRoles(groupId,loanId,taskName);
        rmGroupMaster(groupId);
        getHistComments(processInstanceId);
        creditHistory(loanId);
        documentView(loanId);
        getLoanDetails(groupId,loanId);
    });
</script>
<script type="text/javascript">
    $(document).ready(function() {
        $("#drop").click(function(){

            var dropMember = [];
            $.each($("input[name='drop']:checked"), function(){
                 dropMember.push($(this).val());
            });

            if(dropMember.length == 0){
                $.alert("No members Chosen to drop");
                return false;
            }
            dropMemberDetail(loanId,dropMember,groupId);
        });
    });
</script>

<script type="text/javascript">

    function convertTableToJson()
        {
            var rows = [];
            $('table.paymentTable tr').not('thead tr').each(function(i, n){
                var $row = $(n);
                rows.push({
                      "memberId":   $row.find("td:eq(17) input[type='checkbox']").val(),
                      "loanAmount": $row.find("td:eq(7) input[type='text']").val(),
                      "awb":  $row.find("td:eq(8) input[type='text']").val(),
                      "insuranceAmount":  $row.find("td:eq(14)").text(),
                      "solarLight":  $row.find("td:eq(9) input[type='text']").val(),
                      "purpose":  $row.find("td:eq(16) :selected").val(),
                      "atldebt": $row.find("td:eq(18) input[type='text']").val(),
                      "interest": $row.find("td:eq(19) input[type='text']").val(),
                      "prevMonthGroupBalance":  $row.find("td:eq(20) input[type='text']").val(),
                      "currentMonthCollection": $row.find("td:eq(21) input[type='text']").val(),
                      "currentMonthOutstanding":  $row.find("td:eq(22) input[type='text']").val(),
                      "prevLoanGroupAmount": $row.find("td:eq(23) input[type='text']").val(),
                      "sumOldActiveMembersAmount": $row.find("td:eq(24) input[type='text']").val(),
                      "memberLoanAmount":  $row.find("td:eq(25) input[type='text']").val(),
                      "groupId":$row.find("td:eq(26) input[type='text']").val(),
                      "loanTypeId": $row.find("td:eq(27) input[type='text']").val(),
                      "ATLloanId": $row.find("td:eq(28) input[type='text']").val(),
                      "ATLaccNo": $row.find("td:eq(29) input[type='text']").val()
                });
            });
            return JSON.stringify(rows);
        };

    function updateLoanMembers()
    {
        var updateloanData=convertTableToJson();
        updateloanDatail(updateloanData);
    }
    function updateAndApproveLoan(){
        var updateloanData=convertTableToJson();
        approveLoan(updateloanData);
    }
</script>
<style>
    input[type="text"] {
    width: 80px;
    }
</style>
{% endblock %}
<!-- PAGE CONTENT BEGINS -->
{% block content %}
<div class="row" id="main">
<!--2row Start-->
<div class="col-xs-12" >
    <!--second col-xs3 strat-->
    <div class="panel panel-default">
        <div class="panel-heading"><span id="loanTypeName"></span> - <span id="groupName1"></span>  &nbsp&nbsp&nbsp( <span id="appGroupId"></span> )<span id="groupId" style="visibility:hidden;"></span>
        <span id="loanTypeId1" style="visibility:hidden;"></span> </div>
        <div class="panel-body">
        <div align="right" title="Comments">
                <span style="font-size:20px;cursor:pointer" onclick="toggleNav();" onclick="myFunction(this)">
                    <button id="commentsBtn" style="float:right;margin-top:-54px;margin-right:-15px" class="aside-trigger btn btn-danger btn-app btn-xs ace-settings-btn" data-target="#right-menu" data-toggle="modal"  type="button">
                        Comments
                    </button>
                </span>
            </div>
            <div class="col-md-5">
                <div class="profile-user-info profile-user-info-striped">
                    <div class="profile-info-row">
                        <div class="profile-info-name2"> SHG Name </div>
                        <div class="profile-info-value">
                            <span class="editable" id="groupName"></span>
                        </div>
                    </div>
                    <div class="profile-info-row">
                        <div class="profile-info-name2"> SHG ID </div>
                        <div class="profile-info-value">
                            <span class="editable" id="shgId"></span>
                        </div>
                    </div>
                    <div class="profile-info-row">
                        <div class="profile-info-name2"> No Of Members </div>
                        <div class="profile-info-value">
                            <span class="editable" id="groupCount"></span>
                        </div>
                    </div>
                    <div class="profile-info-row">
                        <div class="profile-info-name2"> Installments</div>
                        <div class="profile-info-value">
                            <input type="text" class="editable" id="loanInstallments" onkeypress='validate(event)'></input>
                        </div>
                    </div></div>
                </div>
                <div class="col-md-5">
                <div class="profile-user-info profile-user-info-striped">
                    <div class="profile-info-row">
                        <div class="profile-info-name2"> Loan Amount (INR):</div>
                        <div class="profile-info-value">
                            <span class="editable" id="loanAmount" style="float:right"></span>
                        </div>
                    </div>
                     <div class="profile-info-row">
                         <div class="profile-info-name2"> Processing Fee  (INR):</div>
                             <div class="profile-info-value">
                                <span class="editable" id="processingFee" style="float:right"></span>
                             </div>
                     </div>
                    <div class="profile-info-row">
                        <div class="profile-info-name2"> Service Tax (INR):</div>
                        <div class="profile-info-value">
                            <span class="editable" id="serviceTax" style="float:right"></span>
                        </div>
                    </div>
                    <div class="profile-info-row">
                        <div class="profile-info-name2"> Education Cess (INR):</div>
                        <div class="profile-info-value">
                            <span class="editable" id="educationCess" style="float:right"></span>
                        </div>
                    </div>

                    <div class="profile-info-row">
                        <div class="profile-info-name2"> AWB (INR):</div>
                        <div class="profile-info-value">
                            <span class="editable" id="awb" style="float:right"></span>
                        </div>
                    </div>
                    <div class="profile-info-row">
                        <div class="profile-info-name2"> Sundry Debt(ATL) (INR)):</div>
                        <div class="profile-info-value">
                            <span class="editable" id="sundryDebt" style="float:right"></span>
                        </div>
                    </div>
                    <div class="profile-info-row">
                        <div class="profile-info-name2"> Insurance (INR):</div>
                        <div class="profile-info-value">
                            <span class="editable" id="insuranceAmount" style="float:right"></span>
                        </div>
                    </div>
                    <div class="profile-info-row">
                        <div class="profile-info-name2"> Net Loan Amount (INR):</div>
                        <div class="profile-info-value">
                            <span class="editable" id="netLoanAmount" style="float:right"></span>
                        </div>
                    </div>
                </div>
            </div>
        <!--panel body endend-->
    </div>
    <!--second col-xs3 end-->
</div>
<!--second row end-->
<div class="col-xs-12" >
    <!--2row Start col-10 start-->
    <div class="panel panel-default">
        <div class="panel-body-danger">
            <!--2row panel body start-->
            <div class="tabbable">
                <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab4">
                    <li class="active"><a data-toggle="tab" href="#upload">Member</a></li>
                    <li><a data-toggle="tab" href="#profile4">SHG Credit Enquiry</a></li>
                    <li><a data-toggle="tab" href="#dropdown14">Documents</a></li>
                    <li><a data-toggle="tab" href="#paymentHistory">Payment History</a></li>
                    <li><a data-toggle="tab" href="#groupHistory">Group History</a></li>
                </ul>
                <div class="tab-content">
                    <div id="upload" class="tab-pane in active">
                        <!-- form start-->
                        <section>
                            <!---upload doc startion-->
                            <div id="payment" class="tab-pane in active">
                                <section >
                                    <div class="page-content1">
                                        <div class="row">
                                            <div class="col-xs-12">
                                                <!-- PAGE CONTENT BEGINS -->
                                                <div class="col-xs-12 col-sm-6  col-md-12 widget-container-col" id="widget-container-col-2">
                                                    <div class="widget-box widget-color-blue" id="widget-box-2">
                                                        <div class="widget-body" style="overflow-x:scroll;">
                                                            <div class="widget-main no-padding">
                                                                <table class="table table-striped table-bordered table-hover paymentTable" id="paymentTable" >
                                                                    <thead class="thin-border-bottom">
                                                                        <tr>
                                                                            <th> S.No</th>
                                                                            <th>App Mem Id</th>
                                                                            <th>New Mem</th>
                                                                            <th>Name</th>
                                                                            <th>SB A/C Number</th>
                                                                            <th>Bank Name</th>
                                                                            <th>Prev loan Amnt</th>
                                                                            <th>Loan Amnt</th>
                                                                            <th>AWB</th>
                                                                            <th>Solar Light</th>
                                                                            <th>ATL/ELL Sundry Debt</th>
                                                                            <th>Processing Fee</th>
                                                                            <th>Service Tax</th>
                                                                            <th>Education Cess</th>
                                                                            <th>Insurance</th>
                                                                            <th>Net Amount</th>
                                                                            <th>Purpose</th>
                                                                            <th>Drop Mem</th>
                                                                            <th style="display:none">19atldebt</th>
                                                                            <th style="display:none"> 20 interest</th>
                                                                            <th style="display:none">21prevMonthGroupBalance</th>
                                                                            <th style="display:none">22 currentMonthCollection</th>
                                                                            <th style="display:none">23currentMonthOutstanding</th>
                                                                            <th style="display:none">24prevLoanGroupAmount</th>
                                                                            <th style="display:none"> 25sumOldActiveMembersAmount</th>
                                                                            <th style="display:none"> 26memberLoanAmount</th>
                                                                            <th style="display:none">27groupId</th>
                                                                            <th style="display:none">28 loanTypeId</th>
                                                                            <th style="display:none"> 29 ATLloanId</th>
                                                                            <th style="display:none"> 30 ATLaccNo</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody  id="loandata">
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- /.span -->
                                            </div>
                                            <!-- /.row -->
                                            <!-- PAGE CONTENT ENDS -->
                                        </div>
                                        <!-- /.col -->
                                    </div>
                                </section><br/>
                                <div class="col-md-offset-4">
                                    <button type="button" class="btn btn-danger" id="drop" >Drop Members</button>
                                    <button type="button" class="btn btn-danger" onclick="updateLoanMembers();">Update Members</button>
                                    <button type="button" class="btn btn-danger" onclick="updateAndApproveLoan();">Approve Loan</button>
                                </div>
                                <br>
                            </div>
                            <!-- payment tab start  -->
                            <!--upload doc end-->
                        </section>
                        <!-- SECTION END -->
                    </div>
                    <!--form End-->
                    <!-- Document tab start  -->
                    <div id="dropdown14" class="tab-pane">
                        <div class="page-content1">
                            <div class="row">
                                <div class="col-xs-12">
                                    <!-- PAGE CONTENT BEGINS -->
                                    <div class="col-xs-12 col-sm-6  col-md-12 widget-container-col" id="widget-container-col-2">
                                        <div class="widget-box widget-color-blue" id="widget-box-2">

                                            <div class="widget-body">
                                                <div class="widget-main no-padding">
                                                    <table class="table table-striped table-bordered table-hover" id="docments_table">
                                                        <thead class="thin-border-bottom">
                                                            <tr>
                                                                <th><i class="ace-icon fa fa-sort-numeric-asc"></i>  S.No</th>
                                                                <th><i class="ace-icon fa fa-list-ul"></i>  Document List</th>
                                                                <th><i class="ace-icon fa fa-user"></i>  Action</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>

                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /.span -->
                                </div>
                                <!-- /.row -->
                                <!-- PAGE CONTENT ENDS -->
                            </div>
                            <!-- /.col -->
                        </div>
                    </div>
                    <div id="paymentHistory" class="tab-pane">
                        <div class="page-content1">
                            <div class="row">
                                <div class="col-xs-12">
                                    <!-- PAGE CONTENT BEGINS -->
                                    <div class="col-xs-12 col-sm-6  col-md-12 widget-container-col" id="widget-container-col-2">
                                        <div class="widget-box widget-color-blue" id="widget-box-2">

                                            <div class="widget-body">
                                                <div class="widget-main no-padding">

                                                    <br>
                                                Data not available.<br><br>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /.span -->
                                </div>
                                <!-- /.row -->
                                <!-- PAGE CONTENT ENDS -->
                            </div>
                            <!-- /.col -->
                        </div>
                    </div>
                    <div id="groupHistory" class="tab-pane">
                        <div class="page-content1">
                            <div class="row">
                                <div class="col-xs-12">
                                    <!-- PAGE CONTENT BEGINS -->
                                    <div class="col-xs-12 col-sm-6  col-md-12 widget-container-col" id="widget-container-col-2">
                                        <div class="widget-box widget-color-blue" id="widget-box-2">

                                            <div class="widget-body">
                                                <div class="widget-main no-padding">

                                                    <br>
                                                Data not available.
                                                    <br><br>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /.span -->
                                </div>
                                <!-- /.row -->
                                <!-- PAGE CONTENT ENDS -->
                            </div>
                            <!-- /.col -->
                        </div>
                    </div>
                    <div id="profile4" class="tab-pane">
                        <!--TAB MENU2 CONTENT START-->
                        <div class="page-content1">
                            <div class="row">
                                <div class="col-xs-12">
                                    <!-- PAGE CONTENT BEGINS -->
                                    <div class="col-xs-12 col-sm-6  col-md-12 widget-container-col" id="widget-container-col-2">
                                        <div class="widget-box widget-color-blue" id="widget-box-2">
                                            <div class="scrollable-horizontal" data-size="800">
                                                <div class="widget-body"   style="overflow-x:scroll;">
                                                    <div class="widget-main no-padding">
                                                        <table id="creditTableID" class="table table-striped table-bordered table-hover">
                                                            <thead class="thin-border-bottom">
                                                                <tr>
                                                                    <th>OverLap Report</th>
                                                                    <th>Member ID</th>
                                                                    <th>Member Name</th>
                                                                    <th>Product</th>
                                                                    <th>Status</th>
                                                                    <th>Remarks</th>
                                                                    <th>HM Response Date</th>
                                                                    <th>Existing Loan Limit</th>
                                                                    <th>Loan Amount Eligible</th>
                                                                    <th>MFI Eligible</th>
                                                                    <th>MFI 1 Name</th>
                                                                    <th>Overdue_1</th>
                                                                    <th>Loan Amount_1</th>
                                                                    <th>Balance_1</th>
                                                                    <th>MFI 2 Name</th>
                                                                    <th>Overdue_2</th>
                                                                    <th>Loan Amount_2</th>
                                                                    <th>Balance_2</th>
                                                                    <th>MFI 3 Name</th>
                                                                    <th>Overdue_3</th>
                                                                    <th>Loan Amount_3</th>
                                                                    <th>Balance_3</th>
                                                                    <th>MFI 4 Name</th>
                                                                    <th>Overdue_4</th>
                                                                    <th>Loan Amount_4</th>
                                                                    <th>Balance_4</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="creditData"></tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /.span -->
                                    </div>
                                    <!-- /.row -->
                                    <!-- PAGE CONTENT ENDS -->
                                </div>
                            </div>
                            <!-- /.col -->
                        </div>
                    </div>
                    <!-- Document tab ens  -->
                </div>
                <!-- TAB END-->

            </div>
            <!--2row panel body end-->
        </div>
    </div><br><br><br>
    <!--2row Start col-10 End-->
</div>
<!--2row End-->
{% include 'query.html' %}
{% endblock content %}
